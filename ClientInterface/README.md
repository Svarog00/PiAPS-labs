# Лабораторная работа 2-3. Клиент-серверный чат.
# Архитектура
# Сервер

Во входной функции вызывается функция StartServer(), которая создает экземпляр класса ServerClass. В конструкторе ServerClass создается сокет, который переключается в режим прослушивания и принимает подключения. При подключении клиента создается экземпляр класса Client, содержащий никнейм и сокет, через который приходят сообщения от клиента, и заносится в список. Каждый клиент создает собственный поток, через который асинхронно получаются сообщения и вызывается функция сервера Distribution(), рассылающая всем клиентам сообщение от одного из клиентов.

![](https://github.com/Svarog00/PiAPS-labs/blob/main/ClientInterface/Server/Server.png)

# Клиент

В классе формы содержится экземпляр класса клиент и порт, через который происходит подключение к серверу. При нажатии на кнопку "Connect" форма создает инициализирует объект класса Client, передавая порт и тектстовые поля, через которые получается никнейм, сообщения и IP сервера.
При нажатии на кнопку "Send" вызывается метод клиента, которая отправляет сообщение на сервер.
При нажатии на кнопку "Disconnect" вызывается метод клиента, отправляющий серверу команду "/disconnect".
Класс сервера содержит в себе 4 основных метода, включая конструктор. 
Конструктор получает на вход IP адрес и порт, по которым происходит подключение и два текстовых поля: через первое получаются сообщения, набираемые пользователем; через второе получается никнейм клиента. В конструкторе инициализируется сокет, через который происходит соединение с сервером, и в этот сокет отправялется никнейм, и запускается асинхронная функция GetMessages.
Метод GetMessagesAsync запускает асинхронно метод GetMessages, который принимает на вход сокет и текстовое поле. GetMessages прослушивает сокет сервера и принимает байты, которые переводятся в текст и вставляются в текстовое поле.
Метод Disconnect отправляет на сервер команду для отключения клиента и в текстовое поле, получаемое в параметрах, выводит сообщение о том, что клиент отключился.
Метод SendMessage принимает в аргументах текстовое поле, из которого извлекается текст и отправляется на сервер.

![](https://github.com/Svarog00/PiAPS-labs/blob/main/ClientInterface/ClientInterface/Client.png)

# Контрольные вопросы

-Перечислите основные разновидности клиент-серверной архитектуры.

 Архитектуры файл-сервера (толстый клиент).
 Клиент-сервер базы данных;
 Тонкий клиент и толстый сервер;
 Потолстевший "клиент и "толстый" сервер;

-Опишите стек протоколов используемых при организации клиент-серверной архитектуры.

При организации клиент-серверной архитектуры используется стек протоколов TCP-IP. TCP/IP – это обозначение всей сети, которая работает на основе двух протоколов – TCP и IP. TCP (Transfer Control Protocol) – протокол, который служит для установления надежного соединения между двумя устройствами, передачи информации и подтверждения ее получения. IP (Internet Protocol) – интернет протокол, который отвечает за правильность доставки сообщений по определенному адресу. При этом данные разбиваются на пакеты, которые могут доставляться по-разному.

-Какие компоненты платформы .NET используются для прослушивания входящих подключений на определённом порте?

Нужно создать класс, который будет прослушивать входящие подключения к определенному порту. Для создания объекта слушателя надо передать ему в конструктор объект адрес и порт, по которому будет вестись прослушивание входящих подключений.

-Что такое потоки в программировании?

Поток — это последовательность инструкций, которые выполняются параллельно с другими потоками. Этими инструкциями могут быть чтение и запись в файл, работа с сокетами. Соответственно каждому потоку выделяется свое собственное процессорное время.

-Как реализуются потоки в языке C#?3

Для работы с потоками в C# необходимо подключить специальную директиву: using System.Threading. Именно она позволяет нам реализовывать необходимые потоки и их настройку. Любой поток в C# должен обязательно происходить в каком-либо методе или функции, поэтому для работы с новым потоком необходимо сначала создать для него, например, метод, который и будет точкой входа для этого потока. Для создания потока нужно вызвать делегат Thread, а также передать конструктору адрес метода (в скобках).

-Опишите механизм построения графического пользовательского интерфейса в платформе .NET.

Windows Forms (Формы Windows) — это та часть каркаса .NET Framework, которая поддерживает создание приложений со стандартным графическим пользовательским интерфейсом (GUI) на платформе Windows. Сначала нужно создать главное окно, которое реализовано с помощью некоторого класса MyForm, производного от класса Form (Форма). После этого в окне можно создавать объекты из обширного набора классов для создания графических интерфейсов.

-Опишите принцип работы делегатов в языке C#.

Делегат — это тип, который представляет ссылки на методы с определенным списком параметров и типом возвращаемого значения. При создании экземпляра делегата этот экземпляр можно связать с любым методом с совместимой сигнатурой и типом возвращаемого значения. Метод можно вызвать (активировать) с помощью экземпляра делегата.

-Опишите механизм обновления пользовательского интерфейса из параллельного потока.

Сначала нужно использовать Dispatcher.Invoke чтобы изменить пользовательский интерфейс из другого потока. Для этого можно использовать события. Затем можно зарегистрироваться на это событие (события) в основном классе и отправить изменения в пользовательский интерфейс.
